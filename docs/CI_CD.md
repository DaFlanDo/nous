# üîÑ CI/CD –∏ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ Nous.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã](#–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ-—Ç–µ—Å—Ç—ã)
- [CI/CD Pipeline](#cicd-pipeline)
- [–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#–ª–æ–∫–∞–ª—å–Ω–æ–µ-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ç–µ—Å—Ç–æ–≤)

## üß™ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ API —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

- ‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
  - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è email
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

- ‚úÖ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
  - –õ–æ–≥–∏–Ω —Å email/password
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–≤–µ—Ä–Ω—ã—Ö credentials
  - JWT —Ç–æ–∫–µ–Ω—ã
  - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

- ‚úÖ **–†–∞–±–æ—Ç–∞ —Å –∑–∞–º–µ—Ç–∫–∞–º–∏**
  - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫
  - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–º–µ—Ç–æ–∫
  - –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –ø–æ ID
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫
  - –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫

- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —á—É–∂–∏–º –∑–∞–º–µ—Ç–∫–∞–º

## üîÑ CI/CD Pipeline

### GitHub Actions Workflow

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π pipeline –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏:
- Push –≤ –≤–µ—Ç–∫–∏ `main` –∏–ª–∏ `develop`
- Pull Request –≤ —ç—Ç–∏ –≤–µ—Ç–∫–∏

### –≠—Ç–∞–ø—ã Pipeline

1. **Backend Tests**
   - –ó–∞–ø—É—Å–∫ MongoDB –≤ Docker
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - –ó–∞–ø—É—Å–∫ backend —Å–µ—Ä–≤–µ—Ä–∞
   - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ API —Ç–µ—Å—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoint

2. **Frontend Tests**
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js –∏ yarn
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞
   - –°–±–æ—Ä–∫–∞ production –≤–µ—Ä—Å–∏–∏

3. **Docker Build** (—Ç–æ–ª—å–∫–æ –¥–ª—è main)
   - –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤ backend –∏ frontend
   - Push –≤ GitHub Container Registry
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏

4. **Deploy** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –≤–æ –≤–∫–ª–∞–¥–∫–µ **Actions** –Ω–∞ GitHub:
```
https://github.com/–í–ê–®–ï_–ò–ú–Ø/nous/actions
```

## üñ•Ô∏è –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. **–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ MongoDB –∑–∞–ø—É—â–µ–Ω:**
```bash
# macOS —Å Homebrew
brew services start mongodb-community@7.0

# –∏–ª–∏ —á–µ—Ä–µ–∑ Docker
docker run -d -p 27017:27017 --name mongodb mongo:7.0
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```bash
cd tests
pip install -r requirements.txt
```

3. **–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω:**
```bash
cd backend
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª
python -m uvicorn server:app --reload
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

**–í—Å–µ —Ç–µ—Å—Ç—ã:**
```bash
cd tests
pytest test_api.py -v
```

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∞—Å—Å:**
```bash
pytest test_api.py::TestAuthentication -v
```

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç:**
```bash
pytest test_api.py::TestAuthentication::test_register_new_user -v
```

**–° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º:**
```bash
pytest test_api.py -v -s
```

**–° coverage –æ—Ç—á–µ—Ç–æ–º:**
```bash
pip install pytest-cov
pytest test_api.py --cov=backend --cov-report=html
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `tests`:
```env
API_BASE_URL=http://localhost:8000
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ test_api.py          # API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ requirements.txt      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îî‚îÄ‚îÄ test-results/        # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
```

### test_api.py

```python
- TestAuthentication     # –¢–µ—Å—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  ‚îú‚îÄ‚îÄ test_register_new_user
  ‚îú‚îÄ‚îÄ test_register_duplicate_email
  ‚îú‚îÄ‚îÄ test_login_success
  ‚îú‚îÄ‚îÄ test_login_wrong_password
  ‚îú‚îÄ‚îÄ test_login_nonexistent_user
  ‚îú‚îÄ‚îÄ test_get_current_user
  ‚îî‚îÄ‚îÄ test_get_current_user_invalid_token

- TestNotes             # –¢–µ—Å—Ç—ã –∑–∞–º–µ—Ç–æ–∫
  ‚îú‚îÄ‚îÄ test_create_note
  ‚îú‚îÄ‚îÄ test_create_note_without_auth
  ‚îú‚îÄ‚îÄ test_get_notes
  ‚îú‚îÄ‚îÄ test_get_note_by_id
  ‚îú‚îÄ‚îÄ test_update_note
  ‚îî‚îÄ‚îÄ test_delete_note

- TestNotesSecurity     # –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  ‚îî‚îÄ‚îÄ test_cannot_access_other_user_note
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### pytest.ini

```ini
[pytest]
asyncio_mode = auto
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = -v -s --tb=short
```

### –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã

**client** - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç:
```python
@pytest.fixture
async def client():
    async with httpx.AsyncClient(timeout=30.0) as client:
        yield client
```

**registered_user** - –°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```python
@pytest.fixture
async def registered_user(client):
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω
    ...
```

## üìä –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD

### –°—Ç–∞—Ç—É—Å Badge

–î–æ–±–∞–≤—å—Ç–µ –≤ README.md:
```markdown
![CI/CD](https://github.com/–í–ê–®–ï_–ò–ú–Ø/nous/workflows/CI/CD%20Pipeline/badge.svg)
```

### –ó–∞—â–∏—Ç–∞ –≤–µ—Ç–æ–∫

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞—â–∏—Ç—É –≤–µ—Ç–æ–∫ –≤ GitHub:
1. Settings ‚Üí Branches ‚Üí Branch protection rules
2. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è `main`
3. –í–∫–ª—é—á–∏—Ç–µ:
   - ‚úÖ Require status checks to pass before merging
   - ‚úÖ Require branches to be up to date before merging
   - –í—ã–±–µ—Ä–∏—Ç–µ: `test-backend`, `test-frontend`

### –°–µ–∫—Ä–µ—Ç—ã GitHub Actions

–î–ª—è –¥–µ–ø–ª–æ—è –¥–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ Settings ‚Üí Secrets and variables ‚Üí Actions:

```
RAILWAY_TOKEN          # –î–ª—è Railway –¥–µ–ø–ª–æ—è
RENDER_API_KEY         # –î–ª—è Render –¥–µ–ø–ª–æ—è
DOCKER_USERNAME        # –î–ª—è Docker Hub
DOCKER_PASSWORD        # –î–ª—è Docker Hub
```

## üêõ –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤—å—Ç–µ –≤ —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø—Ä–æ—Å–æ–≤

```python
async def test_example(client):
    response = await client.post(...)
    print(f"Status: {response.status_code}")
    print(f"Response: {response.text}")
    assert response.status_code == 200
```

### –ü–∞—É–∑—ã –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏

```python
import asyncio

async def test_with_delay(client):
    await asyncio.sleep(1)  # –ü–∞—É–∑–∞ 1 —Å–µ–∫—É–Ω–¥–∞
```

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª `test_*.py` –≤ –ø–∞–ø–∫–µ `tests`
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã

–ü—Ä–∏–º–µ—Ä –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞:
```python
import pytest

class TestNewFeature:
    @pytest.mark.asyncio
    async def test_new_functionality(self, client, registered_user):
        response = await client.get(
            "/api/new-endpoint",
            headers={"Authorization": f"Bearer {registered_user['token']}"}
        )
        assert response.status_code == 200
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Coverage –æ—Ç—á–µ—Ç—ã

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞
pytest --cov=backend --cov-report=html

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–∞
open htmlcov/index.html  # macOS
xdg-open htmlcov/index.html  # Linux
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤

```bash
# –û—Ç—á–µ—Ç –æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
pytest --durations=10
```

## ‚úÖ Checklist –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ö–æ–¥ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω (black, prettier)
- [ ] –ù–µ—Ç warnings –≤ —Ç–µ—Å—Ç–∞—Ö
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω coverage (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ >80%)

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Ç–µ—Å—Ç–∞–º–∏:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ MongoDB –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ backend —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ç–µ—Å—Ç–æ–≤ —Å —Ñ–ª–∞–≥–æ–º `-v -s`
5. –ò–∑—É—á–∏—Ç–µ –≤—ã–≤–æ–¥ GitHub Actions

---

**–°—á–∞—Å—Ç–ª–∏–≤–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è! üéØ**
